I".<p>Merhaba. BugÃ¼n <strong>State Design Pattern</strong>â€˜Ä±n Rubyâ€™deki kullanÄ±mÄ±ndan bahsetmek istiyorum.</p>

<p>State design pattern, behavior pattern altÄ±nda tanÄ±mlanÄ±r. Bu patternâ€™da bir nesnenin farklÄ± durumlarda farklÄ± ÅŸekillerde Ã§alÄ±ÅŸmasÄ±nÄ± dÃ¼zenlenir. Yani bir nesnenin durumu deÄŸiÅŸtiÄŸinde o nesnenin Ã§alÄ±ÅŸma ÅŸekli deÄŸiÅŸir. Bu duruma en gÃ¼zel Ã¶rnek trafik Ä±ÅŸÄ±klarÄ±nÄ± verebiliriz. GÃ¶rme engelliler iÃ§in trafik Ä±ÅŸÄ±klarÄ±nÄ± dÃ¼ÅŸÃ¼nÃ¼n, kÄ±rmÄ±zÄ±, sarÄ± ve yeÅŸil yandÄ±ÄŸÄ±nda, durun, bekleyin ve geÃ§in diyor. IÅŸÄ±klar arasÄ± geÃ§iÅŸlerde ise birkaÃ§ saniye boÅŸluk vererek, diÄŸer Ä±ÅŸÄ±ÄŸa geÃ§iyor. Bu durumda Ä±ÅŸÄ±klarÄ±n stateâ€™leri deÄŸiÅŸiyor ve yapacaklarÄ± eylemler de stateâ€™lere gÃ¶re belli oluyor.</p>

<p>State design patternâ€™Ä±n 3 ana componentâ€™dan oluÅŸuyor.</p>

<ul>
  <li>Context Class: Mevcut durumu bilen class.</li>
  <li>State Class: tanÄ±mlanmÄ±ÅŸ stateâ€™lerin yapacaÄŸÄ± iÅŸleri bilen class.</li>
  <li>State classâ€™Ä±ndan tÃ¼retilmiÅŸ bÃ¼tÃ¼n durumlar iÃ§in olan classâ€™lar.</li>
</ul>

<p>Peki bu durumun yararÄ± nedir? BÃ¼tÃ¼n stateâ€™ler kendi durumlarÄ±nÄ± yapacaklarÄ± iÅŸi ve sonraki stateâ€™i biliyor. Mevcut stateâ€™in ne olduÄŸuyla ilgilenmiyor. AslÄ±nda bu design yerine if/else de kullanÄ±bilir ancak hem mimari olarak hem de kodu okumak anlamÄ±nda if/else kullanmak daha zor olacaktÄ±r.</p>

<p>Åimdi bu tanÄ±mlarÄ± Rubyâ€™de trafik Ä±ÅŸÄ±klarÄ± Ã¶rneÄŸi ile nasÄ±l yazabiliriz, ona bakalÄ±m.</p>

<p>Ã–ncelikle bir context classâ€™Ä±na ihtiyacÄ±mÄ±z var. TrafficLight classâ€™Ä±nÄ± context olarak belirliyoruz.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TrafficLight</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@state</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="n">klass</span> <span class="o">=</span> <span class="no">Green</span><span class="p">)</span>
    <span class="vi">@state</span> <span class="o">=</span> <span class="n">klass</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
    <span class="vi">@state</span><span class="p">.</span><span class="nf">beep</span>
    <span class="vi">@state</span><span class="p">.</span><span class="nf">start_timer</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>SonrasÄ±nda ise bir State classâ€™Ä± tanÄ±mlÄ±yoruz.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">State</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">light</span><span class="p">)</span>
    <span class="vi">@light</span> <span class="o">=</span> <span class="n">light</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">beep</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">next_state</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">start_timer</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Green state ve diÄŸerleri iÃ§in ÅŸu ÅŸekilde bir class tanÄ±mlayabiliriz.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Green</span> <span class="o">&lt;</span> <span class="no">State</span>
  <span class="k">def</span> <span class="nf">beep</span>
    <span class="nb">puts</span> <span class="s2">"Color is now green"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">next_state</span>
    <span class="vi">@light</span><span class="p">.</span><span class="nf">next_state</span><span class="p">(</span><span class="no">Yellow</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">start_timer</span>
    <span class="nb">sleep</span> <span class="mi">5</span><span class="p">;</span> <span class="n">next_state</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Yellow</span> <span class="o">&lt;</span> <span class="no">State</span>
  <span class="k">def</span> <span class="nf">beep</span>
    <span class="nb">puts</span> <span class="s2">"Color is now yellow"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">next_state</span>
    <span class="vi">@light</span><span class="p">.</span><span class="nf">next_state</span><span class="p">(</span><span class="no">Red</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">start_timer</span>
    <span class="nb">sleep</span> <span class="mi">5</span><span class="p">;</span> <span class="n">next_state</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Red</span> <span class="o">&lt;</span> <span class="no">State</span>
  <span class="k">def</span> <span class="nf">beep</span>
    <span class="nb">puts</span> <span class="s2">"Color is now red"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">next_state</span>
    <span class="vi">@light</span><span class="p">.</span><span class="nf">next_state</span><span class="p">(</span><span class="n">green</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">start_timer</span>
    <span class="nb">sleep</span> <span class="mi">5</span><span class="p">;</span> <span class="n">next_state</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>ArtÄ±k her state ne yapacaÄŸÄ± ve kendisinden sonra hangi stateâ€™in geleceÄŸini biliyor.</p>

<p>Daha gerÃ§ekÃ§i ve Ã§alÄ±ÅŸan Ã¶rnek iÃ§in <a href="https://github.com/ryanb/ruby-warrior">RubyWarrior</a>â€˜Ä± inceleyebilirsiniz.</p>

<p>EÄŸer Ruby projelerinizde state machine kullanmak istiyorsanÄ±z <a href="https://github.com/aasm/aasm">AASM</a> deneyebilirsiniz. Bu gem ile stateâ€™lerin durumlarÄ±nÄ± takip edebilir, callbackâ€™ler ile eventâ€™leri yÃ¶netebilirsiniz.</p>

<p>Sevgiler.</p>

<p><small><strong>Referanslar:</strong></small></p>

<p><small><em>https://www.rubyguides.com/2018/12/state-machines/?tl_inbound=1&amp;tl_target_all=1&amp;tl_form_type=1&amp;tl_period_type=1</em></small></p>
:ET