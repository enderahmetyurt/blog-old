I""<p>Merhaba, Ruby her ne kadar sÃ¼per sevimli bir dil olsa da dinamik bir dil olduÄŸu iÃ§in yazÄ±lan kodlarda ortaya Ã§Ä±kan hatalar ancak runtimeâ€™da kendini gÃ¶sterebiliyor.</p>

<p>Ancak statik programlama dillerinde kodlarda ortaya Ã§Ä±kan hatalarÄ± compile timeâ€™da alabiliyoruz. Bu duruma bir Ã¶rnek vermek gerekirse Rubyâ€™de</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">animal</span> <span class="o">=</span> <span class="s1">'Foo'</span>
<span class="n">animal</span><span class="p">.</span><span class="nf">greeting</span>
</code></pre></div></div>

<p>YukarÄ±daki kod bize ancak code Ã§alÄ±ÅŸtÄ±ÄŸÄ± zaman <code class="language-plaintext highlighter-rouge">NoMethodError</code> hatasÄ±nÄ± dÃ¶necektir. Ancak bu kodu Java gibi compile edilen bir dil ile yazsaydik, hatayÄ± kod compile edildiÄŸi zaman alacaktÄ±k ve kod iÃ§indeki hatalari minimize etme ÅŸansÄ±mÄ±z olacaktÄ±.</p>

<h2 id="sorbet">Sorbet</h2>

<p>Ruby iÃ§in geliÅŸtirilmiÅŸ ve kodunuzdaki method tanÄ±mlarÄ±nÄ±, method signature kontrolleri ve deÄŸiÅŸken tiplerinin kontrolÃ¼nÃ¼ yapan bir Ruby Gemâ€™i. Ã–zÃ¼nde normal Ruby gibi kodumuzu yazÄ±yoruz ancak Sorbet kullanmak istiyor ve type check yapmak istiyorsak ile Sorbetâ€™in <code class="language-plaintext highlighter-rouge">T::Sig</code> modulÃ¼nÃ¼ kullanarak kontrollerimizi yapabiliyoruz.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># typed: true</span>
<span class="nb">require</span> <span class="s1">'sorbet-runtime'</span>

<span class="k">class</span> <span class="nc">A</span>
  <span class="kp">extend</span> <span class="no">T</span><span class="o">::</span><span class="no">Sig</span>

  <span class="n">sig</span> <span class="p">{</span><span class="n">params</span><span class="p">(</span><span class="ss">x: </span><span class="no">Integer</span><span class="p">).</span><span class="nf">returns</span><span class="p">(</span><span class="no">String</span><span class="p">)}</span>
  <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span><span class="p">.</span><span class="nf">to_s</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">main</span>
  <span class="no">A</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">barr</span><span class="p">(</span><span class="mi">91</span><span class="p">)</span>   <span class="c1"># error: Typo!</span>
  <span class="no">A</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="s2">"91"</span><span class="p">)</span>  <span class="c1"># error: Type mismatch!</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Ä°lk olarak Sorbetâ€™e statik tip kontrollerini ne ÅŸekilde raporlamasÄ± gerektiÄŸini belirtmek gerekiyor. <code class="language-plaintext highlighter-rouge"># typed: true</code> dediÄŸimiz zaman normal type hatalarÄ±nÄ± raporla demek oluyor. Bu ÅŸekilde yapabileceÄŸimiz tam beÅŸ adet level var. Bu tiplere ve detaylarÄ±na <a href="https://sorbet.org/docs/static">buradan</a> ulaÅŸabilirsiniz. <code class="language-plaintext highlighter-rouge">sorbet-runtime</code>â€˜Ä± require ediyoruz Ã§Ã¼nku bu kod Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ± zaman da hatayÄ± bize dÃ¶ndÃ¼rsÃ¼n istiyoruz. Sonrasinda <code class="language-plaintext highlighter-rouge">A</code> adÄ±nda bir classâ€™Ä±mÄ±z var ve bu classâ€™Ä±n instanceâ€™Ä±nÄ±n bir <code class="language-plaintext highlighter-rouge">bar</code> adÄ±nda bir methodu var. Rubyâ€™de methodlara verilen parametlerin tipi ve methodâ€™larÄ±n dÃ¶ndÃ¼rdÃ¼ÄŸÃ¼ deÄŸelerin tiplerinin pek Ã¶nemi olmazken Sorbet ile bunlari <code class="language-plaintext highlighter-rouge">sig</code> methodu ile belirleyebiliyoruz. <code class="language-plaintext highlighter-rouge">sig {params(x: Integer).returns(String)}</code> ile bu method integer tipinde bir parametre alÄ±r ve String tipinde birÅŸey dÃ¶ner diyoruz.</p>

<p>Siz de Sorbetâ€™i hÄ±zlica denemek istiyorsaniz <a href="https://sorbet.run/#%23%20typed%3A%20true%0Arequire%20'sorbet-runtime'%0A%0Aclass%20A%0A%20%20extend%20T%3A%3ASig%0A%0A%20%20sig%20%7Bparams(x%3A%20Integer).returns(String)%7D%0A%20%20def%20bar(x)%0A%20%20%20%20x.to_s%0A%20%20end%0Aend%0A%0Adef%20main%0A%20%20A.new.barr(91)%20%20%20%23%20error%3A%20Typo!%0A%20%20A.new.bar(%2291%22)%20%20%23%20error%3A%20Type%20mismatch!%0Aend">buradan</a> online Sorbet runtime aracÄ±nÄ± kullanabilirsiniz.</p>

<h3 id="kurulum">Kurulum</h3>

<p>Sorbetâ€™i projelerimize eklemek iÃ§in Ã¶ncelikle <code class="language-plaintext highlighter-rouge">Gemfile</code> dosyamÄ±za Sorbet ve Sorbet Runtime Gemâ€™lerini eklememiz gerekiyor.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># -- Gemfile --

gem 'sorbet', :group =&gt; :development
gem 'sorbet-runtime'
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">$ bundle install</code> ile Gemâ€™leri indirdikten sonra artÄ±k Sorbet kullanmaya baÅŸlayabiliriz.</p>

<h3 id="kullanÄ±m">KullanÄ±m</h3>

<p>Sorbetâ€™i kullanacaÄŸÄ±mÄ±z projenin altinda <code class="language-plaintext highlighter-rouge">$ srb init</code> diyerek Sorbet iÃ§in gerekli olan dosyalarÄ± oluÅŸturuyoruz. Bu dosyalar Sorbet tarafÄ±ndan otomatik oluÅŸuyor. <code class="language-plaintext highlighter-rouge">sorbet</code> klasÃ¶rÃ¼ altÄ±nda <code class="language-plaintext highlighter-rouge">config</code> dosyasi ve <code class="language-plaintext highlighter-rouge">rbi</code> klasÃ¶rÃ¼ bulunuyor. <code class="language-plaintext highlighter-rouge">config</code> dosyasÄ± iÃ§inde Sorbet iÃ§in commandline ayarlarÄ±nÄ± yapabilirsiniz. Daha fazla detaya <a href="https://sorbet.org/docs/cli">buradan</a> bakabilirsiniz. <code class="language-plaintext highlighter-rouge">rbi</code> klasÃ¶rÃ¼ iÃ§inde ise Sorbet iÃ§inde bulunmayan sizin kendi class, module ve diÄŸer nesne tanÄ±mlarÄ±nÄ±zÄ± yapabilir, Sorbetâ€™te bunlarÄ± kullanabilirsiniz. Sorbet ile gelen RBI dosyalarÄ±na <a href="buradan">buradan</a> ulaÅŸabilirsiniz.</p>

<p>Kendi yazdÄ±ÄŸÄ±mÄ±z Ruby kodlarÄ±ndaki type checkâ€™leri yapmak iÃ§in ise, <code class="language-plaintext highlighter-rouge">$ srb tc</code> komudunu Ã§alÄ±ÅŸtÄ±rarak yapabiliriz.</p>

<h3 id="Ã¶rnek">Ã–rnek</h3>

<p>Ben daha Ã¶nceden yazmÄ±ÅŸ olduÄŸum Ruby Gemâ€™ime Sorbetâ€™i ekledim. Bu <a href="https://github.com/enderahmetyurt/bilisim_sozlugu/commit/6854a4a607461073b2dc69569b70deeee040c0ec">commit</a>â€˜te gÃ¶rÃ¼ldÃ¼ÄŸÃ¼ gibi <code class="language-plaintext highlighter-rouge">search</code> methoduna <code class="language-plaintext highlighter-rouge">sig {params(word: String).void}</code> ekledim. Bu method konsola birÅŸeyler bastÄ±ÄŸÄ± iÃ§in <code class="language-plaintext highlighter-rouge">nil</code> dÃ¶nÃ¼yordu ve <code class="language-plaintext highlighter-rouge">void</code> ile aslÄ±nda bu methodâ€™un birÅŸey dÃ¶nmediÄŸini belirttim. AyrÄ±ca lokal deÄŸiÅŸkenlere de tipler tanÄ±mladÄ±m. Mesela <code class="language-plaintext highlighter-rouge">CSS_SELECTOR</code> iÃ§in sadece String olabilir demek istedim ve <code class="language-plaintext highlighter-rouge">CSS_SELECTOR = T.let("table tbody tr".freeze, String)</code> bu ÅŸekilde yazarak bu deÄŸiÅŸken sadece String kabul etmelidir dedim. Kodun diÄŸer yerlerinde eÄŸer bu deÄŸiÅŸkeni String dÄ±ÅŸÄ±nda bir tipe eÅŸitlersem Sorbet bana hata dÃ¶necek. Sizler de bu kodu dÃ¼zeltmek isterseniz PRâ€™larÄ±nÄ±zÄ± memnuniyet ile bekliyorum.</p>

<h3 id="sonuÃ§">SonuÃ§</h3>

<p>Ben Sorbetâ€™i Ã§ok sevdim ve kendi yazdÄ±ÄŸÄ±m kÃ¼Ã§Ã¼k Ruby projeleri iÃ§in implemente etmeye baÅŸladÄ±m. Hepinizin merak ettiÄŸi bu iÅŸ Ruby on Railsâ€™da nasÄ±l oluyor sorularÄ±na ise kÄ±sa bir zamanda cevap verebilmeyi ben de istiyorum. Konu ile alakalÄ± <a href="https://flexport.engineering/adding-sorbet-to-a-rails-monolith-ef72d6a18449">ÅŸÃ¶yle</a> bir yazÄ± var, isterseniz inceleyebilirsiniz.</p>

<p>Ruby her ne kadar sÃ¼personik bir dil olsa da her gÃ¼zelin bir kusuru var ve o kusurda Sorbet ile biraz olsun kapatÄ±labiliyor.</p>

<p>Sevgiler.</p>

<p><em>Referanslar:</em></p>

<ul>
  <li><a href="https://blog.heroku.com/static-typing-ruby-with-sorbet">https://blog.heroku.com/static-typing-ruby-with-sorbet</a></li>
  <li><a href="https://medium.com/better-programming/static-typed-ruby-introducing-sorbet-from-stripe-eeb4ffd8644">https://medium.com/better-programming/static-typed-ruby-introducing-sorbet-from-stripe-eeb4ffd8644</a></li>
  <li><a href="https://sorbet.org/docs/overview">https://sorbet.org/docs/overview</a></li>
</ul>
:ET